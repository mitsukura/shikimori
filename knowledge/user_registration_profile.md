# ユーザープロフィール登録機能について

## 概要

プロフィール登録画面からユーザー情報をSupabaseに登録する機能について説明します。この機能は`/app/profile/page.tsx`に実装されています。

## 実装内容

### テーブル構造

Supabaseには以下のテーブルが利用されています：

**users テーブル**
   - id（PK）
   - clerk_id（Clerkとの連携ID）
   - email
   - first_name
   - last_name
   - phone（電話番号）
   - address（住所）
   - created_at
   - updated_at

### フロー

1. ユーザーがログインすると、Clerkから認証情報を取得
2. `clerk_id`を使ってSupabaseの`users`テーブルを検索
3. ユーザーが存在しない場合は新規作成し、基本情報を保存
4. フォームにユーザー情報を表示
5. ユーザーが情報を更新し、保存すると`users`テーブルを直接更新

### フォーム項目

プロフィールフォームでは以下の情報を編集できます：

- **表示名**: 必須項目（編集不可、Clerkの`first_name`と`last_name`から自動生成）
- **電話番号 (phone)**: 任意
- **住所 (address)**: 任意

### バリデーション

- 表示名は必須項目として設定
- React Hook Formを使用したフォーム管理とバリデーション

### 実装のポイント

1. **Clerk と Supabase の連携**：
   - ClerkからユーザーIDを取得し、Supabaseのデータと紐づけ
   - ユーザーが存在しない場合は自動的に作成
   - 表示名は`first_name`と`last_name`から自動生成

2. **エラーハンドリング**：
   - API呼び出しのエラーをキャッチし、トーストメッセージで表示
   - 不正な状態の回復処理

3. **UI/UX**：
   - レスポンシブデザイン（モバイル対応）
   - 読み込み中の表示
   - ボタンの無効化（処理中）

## 注意点

- ユーザー情報はClerk認証と連携していますが、拡張データ（電話番号、住所など）はSupabaseに保存
- 基本的なユーザー情報（メールアドレス、名前）はClerkから自動取得され、Supabaseにも同期
- 設計をシンプルにするため、プロフィール情報を別テーブルに分けず`users`テーブルに直接保存

## 今後の拡張可能性

- プロフィール画像のアップロード機能
- 独自の表示名設定機能
- より詳細なプロフィール情報の追加（プロフィールテーブルの導入検討）
